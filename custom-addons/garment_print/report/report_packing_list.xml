<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Report Action -->
    <record id="action_report_packing_list" model="ir.actions.report">
        <field name="name">In Packing List</field>
        <field name="model">garment.packing.list</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">garment_print.report_packing_list_document</field>
        <field name="report_file">garment_print.report_packing_list_document</field>
        <field name="binding_model_id" ref="garment_packing.model_garment_packing_list"/>
        <field name="binding_type">report</field>
        <field name="print_report_name">'PackingList_%s' % object.name</field>
    </record>

    <!-- Report Template -->
    <template id="report_packing_list_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="web.external_layout">
                    <div class="page">
                        <h2 class="text-center mb-4">PACKING LIST</h2>

                        <!-- Header Info -->
                        <div class="row mb-3">
                            <div class="col-6">
                                <table class="table table-sm table-borderless">
                                    <tr><td><strong>Packing List No:</strong></td><td><t t-esc="doc.name"/></td></tr>
                                    <tr><td><strong>Buyer:</strong></td><td><t t-esc="doc.buyer_id.name"/></td></tr>
                                    <tr><td><strong>PO Number:</strong></td><td><t t-esc="doc.po_number or '-'"/></td></tr>
                                    <tr><td><strong>Style:</strong></td><td><t t-esc="doc.style_id.name if doc.style_id else '-'"/></td></tr>
                                    <tr><td><strong>Order Ref:</strong></td><td><t t-esc="doc.garment_order_id.name if doc.garment_order_id else '-'"/></td></tr>
                                </table>
                            </div>
                            <div class="col-6">
                                <table class="table table-sm table-borderless">
                                    <tr><td><strong>Packing Date:</strong></td><td><t t-esc="doc.date" t-options="{'widget': 'date'}"/></td></tr>
                                    <tr><td><strong>Ship Mode:</strong></td><td><t t-esc="dict(doc._fields['ship_mode'].selection).get(doc.ship_mode, '-')"/></td></tr>
                                    <tr><td><strong>ETD:</strong></td><td><t t-esc="doc.etd" t-options="{'widget': 'date'}"/></td></tr>
                                    <tr><td><strong>Destination:</strong></td><td><t t-esc="doc.destination_port or '-'"/></td></tr>
                                    <tr><td><strong>Container No:</strong></td><td><t t-esc="doc.container_no or '-'"/></td></tr>
                                    <tr><td><strong>B/L No:</strong></td><td><t t-esc="doc.bl_number or '-'"/></td></tr>
                                </table>
                            </div>
                        </div>

                        <!-- Carton Details -->
                        <h5>Carton Details</h5>
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr style="background-color: #4CAF50; color: white;">
                                    <th>Carton</th>
                                    <th>Size</th>
                                    <th>Color</th>
                                    <th class="text-end">Pcs/Ctn</th>
                                    <th class="text-end">No. Ctns</th>
                                    <th class="text-end">Total Pcs</th>
                                    <th class="text-end">G.W./Ctn</th>
                                    <th class="text-end">N.W./Ctn</th>
                                    <th class="text-end">CBM/Ctn</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="doc.carton_ids" t-as="line">
                                    <tr>
                                        <td><t t-esc="line.carton_from"/> - <t t-esc="line.carton_to"/></td>
                                        <td><t t-esc="line.size_id.name if line.size_id else '-'"/></td>
                                        <td><t t-esc="line.color_id.name if line.color_id else '-'"/></td>
                                        <td class="text-end"><t t-esc="line.pcs_per_carton"/></td>
                                        <td class="text-end"><t t-esc="line.carton_count"/></td>
                                        <td class="text-end"><t t-esc="line.total_pcs"/></td>
                                        <td class="text-end"><t t-esc="'%.2f' % line.gross_weight"/></td>
                                        <td class="text-end"><t t-esc="'%.2f' % line.net_weight"/></td>
                                        <td class="text-end"><t t-esc="'%.4f' % line.cbm_per_carton"/></td>
                                    </tr>
                                </t>
                            </tbody>
                            <tfoot>
                                <tr style="font-weight: bold; background-color: #E8F5E9;">
                                    <td colspan="4" class="text-end">TOTAL:</td>
                                    <td class="text-end"><t t-esc="doc.total_cartons"/> ctns</td>
                                    <td class="text-end"><t t-esc="doc.total_pieces"/> pcs</td>
                                    <td class="text-end"><t t-esc="'%.2f' % doc.total_gross_weight"/> kg</td>
                                    <td class="text-end"><t t-esc="'%.2f' % doc.total_net_weight"/> kg</td>
                                    <td class="text-end"><t t-esc="'%.3f' % doc.total_cbm"/> m³</td>
                                </tr>
                            </tfoot>
                        </table>

                        <!-- Notes -->
                        <t t-if="doc.notes">
                            <p><strong>Notes:</strong> <t t-esc="doc.notes"/></p>
                        </t>

                        <!-- Signature -->
                        <div class="row mt-5">
                            <div class="col-4 text-center">
                                <p>_________________________</p>
                                <p><strong>Người Lập</strong></p>
                            </div>
                            <div class="col-4 text-center">
                                <p>_________________________</p>
                                <p><strong>Trưởng Phòng</strong></p>
                            </div>
                            <div class="col-4 text-center">
                                <p>_________________________</p>
                                <p><strong>Giám Đốc</strong></p>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>
