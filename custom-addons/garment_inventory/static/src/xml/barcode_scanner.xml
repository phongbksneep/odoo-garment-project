<?xml version="1.0" encoding="utf-8"?>
<templates xml:space="preserve">

    <t t-name="garment_inventory.BarcodeScanner">
        <div class="garment-barcode-scanner">

            <!-- Header -->
            <div class="gbs-header">
                <button class="gbs-back-btn" t-on-click="goBack" title="Quay l·∫°i">
                    ‚Üê Quay L·∫°i
                </button>
                <h2>üì∑ Qu√©t Barcode / QR Code</h2>
                <div class="gbs-inventory-info" t-if="inventoryName">
                    Phi·∫øu: <strong t-out="inventoryName"/>
                </div>
            </div>

            <!-- Feedback banner -->
            <div t-if="state.feedback"
                 t-attf-class="gbs-feedback gbs-feedback-{{ state.feedbackType }}">
                <t t-out="state.feedback"/>
            </div>

            <!-- Camera Section -->
            <div class="gbs-camera-section">
                <div t-if="!state.cameraActive and !state.cameraError" class="gbs-camera-placeholder">
                    <div class="gbs-camera-icon">üì∑</div>
                    <p>B·∫•m n√∫t b√™n d∆∞·ªõi ƒë·ªÉ m·ªü camera qu√©t m√£</p>
                    <button class="btn btn-primary btn-lg gbs-start-btn"
                            t-on-click="startCamera">
                        üé• M·ªü Camera Qu√©t M√£
                    </button>
                </div>

                <div t-if="state.cameraError" class="gbs-camera-error">
                    <div class="gbs-error-icon">‚ö†Ô∏è</div>
                    <p t-out="state.cameraError"/>
                    <button class="btn btn-outline-primary mt-2"
                            t-on-click="startCamera">
                        üîÑ Th·ª≠ L·∫°i
                    </button>
                </div>

                <div t-if="state.cameraActive" class="gbs-camera-live">
                    <div class="gbs-video-wrapper">
                        <video id="garment-scanner-video"
                               autoplay="true" playsinline="true" muted="true"/>
                        <div class="gbs-scan-overlay">
                            <div class="gbs-scan-frame"/>
                        </div>
                        <div t-if="state.processing" class="gbs-processing-overlay">
                            ‚è≥ ƒêang x·ª≠ l√Ω...
                        </div>
                    </div>
                    <button class="btn btn-danger mt-2 gbs-stop-btn"
                            t-on-click="stopCamera">
                        ‚èπ T·∫Øt Camera
                    </button>
                </div>

                <!-- Hidden canvas for frame capture -->
                <canvas id="garment-scanner-canvas" class="d-none"/>
            </div>

            <!-- Manual Input Section -->
            <div class="gbs-manual-section">
                <h4>‚å®Ô∏è Nh·∫≠p M√£ Th·ªß C√¥ng</h4>
                <div class="gbs-manual-form">
                    <input type="text"
                           id="garment-manual-barcode-input"
                           class="form-control gbs-barcode-input"
                           placeholder="Nh·∫≠p ho·∫∑c qu√©t m√£ barcode/QR..."
                           t-att-value="state.manualCode"
                           t-on-input="onManualCodeInput"
                           t-on-keydown="onManualKeydown"/>
                    <input type="number"
                           class="form-control gbs-qty-input"
                           min="1" step="1"
                           t-att-value="state.manualQty"
                           t-on-input="onManualQtyInput"
                           placeholder="SL"/>
                    <button class="btn btn-success gbs-manual-btn"
                            t-on-click="onManualScan"
                            t-att-disabled="state.processing">
                        ‚úÖ Nh·∫≠p
                    </button>
                </div>
            </div>

            <!-- Scan Stats -->
            <div class="gbs-stats">
                <div class="gbs-stat-card">
                    <span class="gbs-stat-number" t-out="state.scanCount"/>
                    <span class="gbs-stat-label">L·∫ßn Qu√©t</span>
                </div>
                <div class="gbs-stat-card">
                    <span class="gbs-stat-number" t-out="state.scanHistory.length"/>
                    <span class="gbs-stat-label">M√£ ƒê√£ Qu√©t</span>
                </div>
            </div>

            <!-- Scan History -->
            <div t-if="state.scanHistory.length > 0" class="gbs-history">
                <h4>üìã L·ªãch S·ª≠ Qu√©t</h4>
                <div class="gbs-history-list">
                    <div t-foreach="state.scanHistory" t-as="item" t-key="item.code + '_' + item.time"
                         class="gbs-history-item">
                        <div class="gbs-history-info">
                            <span class="gbs-history-code" t-out="item.code"/>
                            <span class="gbs-history-name" t-out="item.item_name"/>
                        </div>
                        <div class="gbs-history-meta">
                            <span class="gbs-history-qty">SL: <t t-out="item.qty"/></span>
                            <span class="gbs-history-time" t-out="item.time"/>
                            <span t-if="item.is_new" class="badge text-bg-info">M·ªõi</span>
                            <span t-if="!item.is_new" class="badge text-bg-secondary">C·ªông th√™m</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </t>

</templates>
